## Module 3 - Deploying and Managing Virtual Machines

### Creating Virtual Machines

There are many methods for deploying virtual machines. No matter what method you use, these are the basic steps for deploying a virtual machine.

![alt text](https://openedx.microsoft.com/assets/courseware/v1/84a2937088a62911ce61397d4d99616e/asset-v1:Microsoft+AZ-300.1+2019_T2+type@asset+block/AZ-100.3_Deploying_and_Managing_Virtual_Machines_image7.png)

__Windows VM Connections__
- Remote Desktop Protocol (RDP) : TCP port 3389
- Windows Remote Management (WinRM) : TCP port 5986


__Power Shell steps__
![alt text](https://openedx.microsoft.com/assets/courseware/v1/151abd6e0e83d3656755dbfa56ae770f/asset-v1:Microsoft+AZ-300.1+2019_T2+type@asset+block/AZ103_PS_Example_Part1.png)

1. Set the username and password needed for the administrator account on the virtual machine with Get-Credential:
    ```powershell
    $cred = Get-Credential
    ```
2. Create the initial configuration for the virtual machine with New-AzVMConfig:
    ```powershell
    $vm = New-AzVMConfig -VMName myVM -VMSize Standard_D1
    ```
3. Add the operating system information to the virtual machine configuration with Set-AzureRmVMOperatingSystem:
    ```powershell
    $vm = Set-AzVMOperatingSystem `
    -VM $vm `
    -Windows `
    -ComputerName myVM `
    -Credential $cred `
    -ProvisionVMAgent -EnableAutoUpdate 
    ```

![alt text](https://openedx.microsoft.com/assets/courseware/v1/2f6dda54a1461a1f8a1d9c39c07836da/asset-v1:Microsoft+AZ-300.1+2019_T2+type@asset+block/AZ103_PS_Example_Part2.png)

4. Add the image information to the virtual machine configuration with Set-AzVMSourceImage:
    ```powershell
    $vm = Set-AzVMSourceImage `
    -VM $vm `
    -PublisherName MicrosoftWindowsServer `
    -Offer WindowsServer `
    -Skus 2016-Datacenter `
    -Version latest
    ```

5. Add the operating system disk settings to the virtual machine configuration with Set-AzVMOSDisk
    ```powershell
    $vm = Set-AzVMOSDisk `
    -VM $vm `
    -Name myOsDisk `
    -DiskSizeInGB 128 `
    -CreateOption FromImage `
    -Caching ReadWrite
    ```
6. Add the network interface card that you previously created to the virtual machine configuration with Add-AzureRmVMNetworkInterface:
    ```powershell
    $vm = Add-AzVMNetworkInterface -VM $vm -Id $nic.Id 
    ```

7. Create the virtual machine with New-AzVM.
    ```powershell
    New-AzVM -ResourceGroupName myResourceGroupVM -Location EastUS -VM $vm
    ```

__What is SSH?__

SSH is an encrypted connection protocol that allows secure sign-ins over unsecured connections. SSH is the default connection protocol for Linux VMs hosted in Azure. Although SSH itself provides an encrypted connection, using passwords with SSH connections still leaves the VM vulnerable to brute-force attacks or guessing of passwords. A more secure and preferred method of connecting to a VM using SSH is by using a public-private key pair, also known as SSH keys.

- The public key is placed on your Linux VM, or any other service that you wish to use with public-key cryptography.

- The private key remains on your local system. Protect this private key. Do not share it.

> Azure currently requires at least a 2048-bit key length and the SSH-RSA format for public and private keys.



--- 

### Backup and Restore


--- 

### Virtual Machine Extensions


--- 

### Online Lab - Implementing custom Azure VM images


--- 

